<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BlossomGarden Wfl</title>
<style>
  /* Blossom theme */
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: linear-gradient(to bottom right, #ffe8f0, #fff0f7);
    font-family: 'Poppins', 'Segoe UI', sans-serif;
    color: #5e2c4d;
    overflow-x: hidden;
    display: block;
  }

  #app-wrapper {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background: white;
    box-shadow: 0 0 20px rgba(255, 105, 180, 0.25);
    border-radius: 20px;
    user-select: none;
  }

  header {
    background: #ffb3d9;
    color: #fff;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  header h1 {
    margin: 0;
    font-size: 2rem;
    font-weight: 600;
    white-space: nowrap;
  }

  main {
    flex-grow: 1;
    padding: 1rem 2rem;
    overflow-y: auto;
  }

  .slots-wrapper {
    display: flex;
    justify-content: space-around;
    margin: 1rem 0;
    flex-wrap: wrap;
    gap: 10px;
  }

  .slots-container {
    background: #fff0f7;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(255, 105, 180, 0.15);
    padding: 1rem;
    width: 280px;
    min-height: 300px;
  }

  .slots-container h2 {
    margin-top: 0;
    font-weight: 700;
    font-size: 1.5rem;
    color: #d63384;
    text-align: center;
  }

  .slots {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }

  .slot {
    background: white;
    width: 60px;
    height: 60px;
    border-radius: 12px;
    border: 2px solid #ffa5cc;
    color: #d63384;
    font-weight: 700;
    font-size: 2rem;
    line-height: 56px;
    text-align: center;
    cursor: pointer;
    position: relative;
    user-select: none;
    transition: border-color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .slot:hover {
    border-color: #ff6fa5;
  }

  .slot img {
    max-width: 100%;
    max-height: 100%;
    border-radius: 12px;
    object-fit: contain;
  }

  .remove-btn {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #ff6fa5;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    color: white;
    font-weight: 900;
    font-size: 14px;
    line-height: 18px;
    text-align: center;
    cursor: pointer;
    user-select: none;
  }

  .remove-btn:hover {
    background: #d63384;
  }

  #total-you, #total-other {
    text-align: center;
    font-weight: 700;
    font-size: 1.5rem;
    color: #7a3360;
    margin-top: 0.5rem;
  }

  #result-text {
    text-align: center;
    font-weight: 700;
    font-size: 1.8rem;
    margin-top: 1rem;
  }

  .fair {
    color: #5e2c4d;
  }
  .win {
    color: #48c774;
  }
  .lose {
    color: #ff3860;
  }

  #pet-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(94, 44, 77, 0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #pet-modal.active {
    display: flex;
  }

  #pet-modal .modal-content {
    background: white;
    border-radius: 20px;
    width: 90%;
    max-width: 450px;
    max-height: 80vh;
    overflow-y: auto;
    padding: 1rem 1.5rem 2rem;
    box-shadow: 0 0 20px rgba(255, 105, 180, 0.4);
    position: relative;
  }

  #modal-close {
    position: absolute;
    top: 10px;
    right: 15px;
    background: transparent;
    border: none;
    font-size: 1.8rem;
    font-weight: 700;
    color: #d63384;
    cursor: pointer;
  }
  #modal-close:hover {
    color: #ff6fa5;
  }

  #pet-search {
    width: 100%;
    padding: 0.7rem 1rem;
    border: 2px solid #ffa5cc;
    border-radius: 12px;
    font-size: 1rem;
    font-family: 'Poppins', sans-serif;
    outline: none;
    box-shadow: 0 3px 10px rgba(255, 105, 180, 0.15);
    transition: 0.2s ease;
    margin-bottom: 1rem;
  }

  #pet-search:focus {
    border-color: #ff6fa5;
    box-shadow: 0 3px 15px rgba(255, 105, 180, 0.25);
  }

  .pet-item {
    display: flex;
    align-items: center;
    gap: 10px;
    border: 2px solid #ffa5cc;
    border-radius: 12px;
    padding: 0.5rem 1rem;
    margin-bottom: 0.8rem;
    cursor: pointer;
    user-select: none;
    transition: border-color 0.2s ease;
  }

  .pet-item:hover,
  .pet-item:focus {
    border-color: #ff6fa5;
    outline: none;
  }

  .pet-item img {
    width: 50px;
    height: 50px;
    object-fit: contain;
    border-radius: 12px;
  }

  .pet-item p {
    margin: 0;
    font-weight: 600;
    color: #d63384;
  }

  footer {
    text-align: center;
    padding: 1rem;
    background: #ffd6eb;
    color: #7a3360;
    font-weight: 500;
    border-bottom-left-radius: 20px;
    border-bottom-right-radius: 20px;
    user-select: none;
  }

  /* Responsive */
  @media (max-width: 600px) {
    header h1 {
      font-size: 1.4rem;
      max-width: 80%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    header {
      padding: 0.8rem 1rem;
      flex-wrap: wrap;
    }
    main {
      padding: 1rem 1rem;
    }
    .slots-container {
      width: 100%;
      min-height: auto;
    }
  }
</style>
</head>
<body>
<div id="app-wrapper">
  <header>
    <h1 style="font-size: 30px;">BlossomGarden Wfl</h1>
  </header>
  <main>
    <div class="slots-wrapper">
      <section class="slots-container" aria-label="Your pets">
        <h2>Your Pets</h2>
        <div id="slots-you" class="slots" role="list"></div>
        <div id="total-you" aria-live="polite" aria-atomic="true">0.00</div>
      </section>
      <div id="result-text" aria-live="polite" aria-atomic="true" class="fair">Fair</div>
      <section class="slots-container" aria-label="Other pets">
        <h2>Other Pets</h2>
        <div id="slots-other" class="slots" role="list"></div>
        <div id="total-other" aria-live="polite" aria-atomic="true">0.00</div>
      </section>
    </div>

  </main>

  <!-- Pet selection modal -->
  <div id="pet-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-content">
      <button id="modal-close" aria-label="Close modal">&times;</button>
      <input type="search" id="pet-search" placeholder="Search pets..." aria-describedby="modal-title" />
      <div id="pet-list" tabindex="0"></div>
    </div>
  </div>

  <footer>
    Blossom Garden Â© 2025
  </footer>
</div>

<script>
(() => {
  const maxSlots = 6;
  let petsData = [];
  let slotsYou = [];
  let slotsOther = [];
  let currentSide = null;
  let currentSlotIndex = null;

  // DOM Elements
  const slotsContainerYou = document.getElementById("slots-you");
  const slotsContainerOther = document.getElementById("slots-other");
  const totalYouEl = document.getElementById("total-you");
  const totalOtherEl = document.getElementById("total-other");
  const resultText = document.getElementById("result-text");
  const modal = document.getElementById("pet-modal");
  const modalCloseBtn = document.getElementById("modal-close");
  const petListEl = document.getElementById("pet-list");
  const petSearchInput = document.getElementById("pet-search");

  function initSlots() {
    slotsYou = Array(maxSlots).fill(null);
    slotsOther = Array(maxSlots).fill(null);
  }

  function renderSlots(side) {
    const container = side === "you" ? slotsContainerYou : slotsContainerOther;
    const slots = side === "you" ? slotsYou : slotsOther;

    container.innerHTML = "";
    slots.forEach((pet, i) => {
      const slot = document.createElement("div");
      slot.className = "slot";
      slot.setAttribute("data-index", i);
      slot.setAttribute("tabindex", 0);
      slot.setAttribute("role", "button");
      slot.setAttribute("aria-label", pet ? `${pet.name}, click to remove` : "Empty slot, click to add pet");

      if (pet) {
        slot.innerHTML = `
          <img src="${pet.image}" alt="${pet.name}" />
          <div class="remove-btn" aria-label="Remove pet" role="button" tabindex="0">&times;</div>
        `;
      } else {
        slot.textContent = "+";
      }

      container.appendChild(slot);

      if (pet) {
        const removeBtn = slot.querySelector(".remove-btn");
        removeBtn.addEventListener("click", e => {
          e.stopPropagation();
          removePet(side, i);
        });
        slot.addEventListener("click", () => removePet(side, i));
        slot.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            removePet(side, i);
          }
        });
      } else {
        slot.addEventListener("click", () => openPetModal(side, i));
        slot.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openPetModal(side, i);
          }
        });
      }
    });
  }

  function removePet(side, index) {
    if (side === "you") {
      slotsYou[index] = null;
      renderSlots("you");
    } else {
      slotsOther[index] = null;
      renderSlots("other");
    }
    updateTotals();
  }

  function openPetModal(side, index) {
    currentSide = side;
    currentSlotIndex = index;
    petSearchInput.value = "";
    renderPetList(petsData);
    modal.classList.add("active");
    modal.setAttribute("aria-hidden", "false");
    petSearchInput.focus();
  }

  function closePetModal() {
    modal.classList.remove("active");
    modal.setAttribute("aria-hidden", "true");
    currentSide = null;
    currentSlotIndex = null;
  }

  function renderPetList(pets) {
    petListEl.innerHTML = "";
    if (pets.length === 0) {
      petListEl.innerHTML = "<p>No pets found.</p>";
      return;
    }
    pets.forEach(pet => {
      const petDiv = document.createElement("div");
      petDiv.className = "pet-item";
      petDiv.tabIndex = 0;
      petDiv.setAttribute("role", "button");
      petDiv.setAttribute("aria-label", `Add ${pet.name}, value ${pet.value}`);
      petDiv.innerHTML = `
        <img src="${pet.image}" alt="${pet.name}" />
        <p>${pet.name}</p>
        <p>Value: ${pet.value}</p>
      `;
      petDiv.addEventListener("click", () => {
        addPetToSlot(pet);
        closePetModal();
      });
      petDiv.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          addPetToSlot(pet);
          closePetModal();
        }
      });
      petListEl.appendChild(petDiv);
    });
  }

  function addPetToSlot(pet) {
    if (!currentSide || currentSlotIndex === null) return;

    const slots = currentSide === "you" ? slotsYou : slotsOther;

    // Allow multiple same pets â no duplicate check
    slots[currentSlotIndex] = pet;
    renderSlots(currentSide);
    updateTotals();
  }

  function updateTotals() {
    const totalYou = slotsYou.reduce((acc, pet) => acc + (pet ? pet.value : 0), 0);
    const totalOther = slotsOther.reduce((acc, pet) => acc + (pet ? pet.value : 0), 0);

    totalYouEl.textContent = totalYou.toFixed(2);
    totalOtherEl.textContent = totalOther.toFixed(2);

    const diff = totalYou - totalOther;
    if (Math.abs(diff) < 0.01) {
      resultText.textContent = "Fair";
      resultText.className = "fair";
    } else if (diff > 0) {
      resultText.textContent = "Lose";
      resultText.className = "lose";
    } else {
      resultText.textContent = "Win";
      resultText.className = "win";
    }
  }

  petSearchInput.addEventListener("input", () => {
    const val = petSearchInput.value.trim().toLowerCase();
    if (!val) {
      renderPetList(petsData);
      return;
    }
    const filtered = petsData.filter(p => p.name.toLowerCase().includes(val));
    renderPetList(filtered);
  });

  modalCloseBtn.addEventListener("click", closePetModal);
  modal.addEventListener("click", e => {
    if (e.target === modal) closePetModal();
  });
  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && modal.classList.contains("active")) {
      closePetModal();
    }
  });

  async function loadPets() {
    try {
      const res = await fetch("https://raw.githubusercontent.com/UNKNOWN001F/valuesjson/refs/heads/main/mi.json");
      const data = await res.json();
      petsData = data.pets
        .map(p => ({
          name: p.name,
          value: parseFloat(p.value),
          demand: p.demand || '',
          image: p.image
        }))
        .sort((a, b) => b.value - a.value);
      initSlots();
      renderSlots("you");
      renderSlots("other");
      updateTotals();
    } catch (e) {
      alert("Failed to load pet data.");
      console.error(e);
    }
  }

  loadPets();

})();
</script>
</body>
</html>
